#!/usr/bin/env bash

export PROTOCOL="https"
if [ -n "$CODESPACES" ]; then
  PROTOCOL="git"
fi

### Install SBP (simple bash prompt)
git clone "$PROTOCOL://github.com/brujoand/sbp.git" "$HOME/.sbp"

### Install homeshick
git clone "$PROTOCOL://github.com/andsens/homeshick.git" "$HOME/.homesick/repos/homeshick"

# shellcheck disable=SC1091
source "$HOME/.homesick/repos/homeshick/homeshick.sh"

### Clone and link my dotfiles
homeshick clone pjquirk/dotfiles --quiet --batch
homeshick link dotfiles --force

if [ -n "$BP_DEV" ]; then
    instance_id=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)
    aws ec2 describe-tags --filters "Name=resource-id,Values=${instance_id}" --query 'Tags [?Key==`custom_tags`].Value' \
        | tr -d '\n[]" ' \
        >> "$HOME/.bpdev_tags"
fi
